{{- if .Values.rhtpa.syft.enabled }}
{{- if .Values.rhtpa.imageDiscovery.enabled }}
---
# SPIFFE Helper configuration for Image Discovery
apiVersion: v1
kind: ConfigMap
metadata:
  name: image-discovery-spiffe-helper-config
  namespace: {{ .Values.rhtpa.namespace }}
  annotations:
    argocd.argoproj.io/sync-wave: "24"
data:
  spiffe-helper.conf: |
    agent_address = "/spiffe-workload-api/spire-agent.sock"
    cmd = ""
    cmd_args = ""
    cert_dir = ""
    renew_signal = ""
    svid_file_name = ""
    svid_key_file_name = ""
    svid_bundle_file_name = ""
    jwt_audience = "{{ .Values.rhtpa.imageDiscovery.spiffe.audience | default "vault" }}"
    jwt_svids = [
      {
        jwt_audience = "{{ .Values.rhtpa.imageDiscovery.spiffe.audience | default "vault" }}"
        jwt_svid_file_name = "/run/secrets/spiffe/jwt.token"
      }
    ]
{{- end }}
{{- end }}

